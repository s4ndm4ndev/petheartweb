<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en" }}" data-theme="">
<head>
    {{ partial "head.html" . }}
</head>
<body>
    <!-- Skip Navigation Links for Screen Readers -->
    <div class="skip-links">
        <a href="#main-content" class="skip-link">Skip to main content</a>
        <a href="#primary-navigation" class="skip-link">Skip to navigation</a>
        <a href="#footer-content" class="skip-link">Skip to footer</a>
    </div>

    {{ partial "header.html" . }}

    <main id="main-content" role="main" tabindex="-1">
        {{ block "main" . }}{{ end }}
    </main>

    {{ partial "footer.html" . }}
    {{ partial "back-to-top.html" . }}

    <!-- Live region for screen reader announcements -->
    <div id="sr-live-region" class="sr-live-region" aria-live="polite" aria-atomic="true"></div>

    <script>
        // Initialize theme detection
        (function() {
            const savedTheme = localStorage.getItem('theme-preference');
            const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const theme = savedTheme || systemTheme;
            document.documentElement.setAttribute('data-theme', theme);
        })();

        // Performance monitoring (production only)
        {{ if hugo.IsProduction }}
        (function() {
            // Monitor Core Web Vitals
            function sendToAnalytics(metric) {
                // In a real implementation, you would send this to your analytics service
                console.log('Performance metric:', metric);
            }

            // Largest Contentful Paint
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    sendToAnalytics({
                        name: 'LCP',
                        value: entry.startTime,
                        id: 'lcp'
                    });
                }
            }).observe({entryTypes: ['largest-contentful-paint']});

            // First Input Delay
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    sendToAnalytics({
                        name: 'FID',
                        value: entry.processingStart - entry.startTime,
                        id: 'fid'
                    });
                }
            }).observe({entryTypes: ['first-input']});

            // Cumulative Layout Shift
            let clsValue = 0;
            let clsEntries = [];
            new PerformanceObserver((entryList) => {
                for (const entry of entryList.getEntries()) {
                    if (!entry.hadRecentInput) {
                        clsValue += entry.value;
                        clsEntries.push(entry);
                    }
                }
                sendToAnalytics({
                    name: 'CLS',
                    value: clsValue,
                    id: 'cls'
                });
            }).observe({entryTypes: ['layout-shift']});
        })();
        {{ end }}
    </script>
</body>
</html>
